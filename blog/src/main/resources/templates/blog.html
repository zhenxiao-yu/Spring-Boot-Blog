<!DOCTYPE html>
<!--Blog Display Page-->
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:replace="_fragments :: head(~{::title})">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--page title-->
    <title th:text="${blog.title}">ARTICLE TITLE</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.css">
    <link rel="stylesheet" href="../static/css/typo.css">
    <link rel="stylesheet" href="../static/css/animate.css">
    <link rel="stylesheet" href="../static/lib/prism/prism.css">
    <link rel="stylesheet" href="../static/lib/tocbot/tocbot.css">
    <!--custom css file-->
    <link rel="stylesheet" href="../static/css/me.css">
    <link rel="stylesheet" href="../static/css/theme.css">
</head>
<body>

<!--Navigation-->
<nav th:replace="_fragments :: menu(1)" class="ui inverted attached segment m-padded-tb-mini m-shadow-small">
    <!--replaced by fragment template-->

    <!--replaced by fragment template-->
</nav>
<!--Navigation-->

<!--Center Content-->
<div id="waypoint" class="m-container-small m-padded-tb-big animated fadeIn">
    <div class="ui container">
        <div class="ui top attached  inverted segment m-shadow-seg">
            <div class="ui horizontal link list">
                <!--user info-->
                <div class="item">
                    <!--avatar-->
                    <img src="https://unsplash.it/100/100?image=1005" th:src="@{${blog.user.avatar}}" alt=""
                         class="ui avatar image">
                    <!--name-->
                    <div class="content"><a href="#" class="header t-info-small hvr-pop" th:text="${blog.user.nickname}">SAMPLE USER</a>
                    </div>
                </div>
                <!--date-->
                <div class="item t-info-small">
                    <i class="calendar icon"></i> <span th:text="${#dates.format(blog.updateTime,'yyyy-MM-dd')}">SAMPLE DATE</span>
                </div>
                <!--view count-->
                <div class="item t-info-small">
                    <i class="eye icon"></i> <span th:text="${blog.views}">VIEW COUNT</span>
                </div>
            </div>
        </div>

        <div class="ui attached inverted segment">
            <!--thumbnail picture-->
            <img src="https://unsplash.it/800/450?image=1005" th:src="@{${blog.firstPicture}}" alt=""
                 class="ui fluid rounded image">
        </div>
        <div class="ui attached padded inverted segment">
            <!--post content-->
            <div class="ui right aligned basic segment">
                <div class="ui orange basic label" th:text="${blog.flag}">SAMPLE FLAG</div>
            </div>
            <!--post title-->
            <h2 class="ui center aligned header" th:text="${blog.title}">SAMPLE TITLE</h2>
            <br>
            <!--post text-->
            <div id="content" class="typo typo-selection js-toc-content m-padded-lr-responsive m-padded-tb-large"
                 th:utext="${blog.content}">

                <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the
                    industry's
                    standard dummy text ever since the 1500s, when an unknown printer took a galley of type and
                    scrambled it to make a
                    type specimen book. It has survived not only five centuries, but also the leap into electronic
                    typesetting, remaining
                    essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets
                    containing Lorem Ipsum
                    passages, and more recently with desktop publishing software like Aldus PageMaker including versions
                    of Lorem
                    Ipsum.</p>
                <blockquote>
                    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore
                    et dolore magna
                    aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
                    commodo consequat.
                </blockquote>

                <h4>The standard Lorem Ipsum passage, used since the 1500s</h4>

                <p>"Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore
                    et dolore magna
                    aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
                    commodo consequat.
                    Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
                    pariatur. Excepteur sint
                    occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."</p>

                <h4>Section 1.10.32 of "de Finibus Bonorum et Malorum", written by Cicero in 45 BC</h4>

                <p>"Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium,
                    totam rem aperiam,
                    eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.
                    Nemo enim ipsam
                    voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos
                    qui ratione
                    voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet,
                    consectetur, adipisci
                    velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat
                    voluptatem. Ut enim
                    ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex
                    ea commodi
                    consequatur? Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil
                    molestiae consequatur,
                    vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?"</p>
            </div>

            <!--tag-->
            <br>
            <div class="m-padded-lr-responsive">
                <div class="ui divider"></div>
                <div class="ui basic purple left pointing label" th:each="tag : ${blog.tags}" th:text="${tag.name}">
                    SAMPLE TAG
                </div>
            </div>
            <br>

            <!--donate-->
            <div th:if="${blog.appreciation}">
                <div class="ui center aligned basic segment">
                    <button id="payButton" class="ui orange basic circular button">Donate</button>
                </div>
                <div class="ui payQR flowing popup transition hidden">
                    <div class="ui orange basic label">
                        <div class="ui images" style="font-size: inherit !important;">
                            <div class="image">
                                <img src="../static/images/wechat.jpg" th:src="@{/images/wechat.jpg}" alt=""
                                     class="ui rounded bordered image" style="width: 120px">
                                <div>Wechat</div>
                            </div>
                            <div class="image">
                                <img src="../static/images/PayPal.jpg" th:src="@{/images/Paypal.jpg}" alt=""
                                     class="ui rounded bordered image" style="width: 120px">
                                <div>Paypal</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--donate-->
        </div>

        <!--post information-->
        <div class="ui attached positive message" th:if="${blog.shareStatement}">
            <div class="ui middle aligned grid">
                <div class="eleven wide column">
                    <ui class="list">
                        <li>Author：<span th:text="${blog.user.nickname}">SAMPLE USER</span><a href="#"
                                                                                              th:href="@{/about}"
                                                                                              target="_blank">（Contact
                            Author）</a></li>
                        <li>Published On：<span th:text="${#dates.format(blog.createTime,'yyyy-MM-dd HH:mm')}">SAMPLE DATE</span>
                        </li>
                        <li>Last Updated On：<span th:text="${#dates.format(blog.updateTime,'yyyy-MM-dd HH:mm')}">SAMPLE DATE</span>
                        </li>
                        <li>Copyright Notice: © 2021 ZhenXiao Yu | All Rights Reserved</li>
                    </ui>
                </div>
                <div class="five wide column">
                    <img src="../static/images/wechat.jpg" th:src="@{/images/wechat.jpg}" alt=""
                         class="ui right floated rounded bordered image" style="width: 110px">
                </div>
            </div>
        </div>
        <!--post information-->

        <!--Comment Section-->
        <div class="ui bottom attached segment" th:if="${blog.commentabled}">
            <div id="comment-container" class="ui purple segment">
                <div th:fragment="commentList">
                    <div class="ui threaded comments" style="max-width: 100%;">
                        <!--comment section header-->
                        <h3 class="ui dividing header">Comment</h3>
                        <!--comment thread-->
                        <div class="comment" th:each="comment : ${comments}">
                            <a class="avatar">
                                <img src="https://unsplash.it/100/100?image=1005" th:src="@{${comment.avatar}}">
                            </a>
                            <div class="content">
                                <a class="author">
                                    <span th:text="${comment.nickname}">SAMPLE USER</span>
                                    <div class="ui mini basic purple left pointing label m-padded-mini"
                                         th:if="${comment.adminComment}">ADMIN
                                    </div>
                                </a>
                                <div class="metadata">
                                    <span class="date"
                                          th:text="${#dates.format(comment.createTime,'yyyy-MM-dd HH:mm')}">SAMPLE TIME</span>
                                </div>
                                <div class="text" th:text="${comment.content}">
                                    SAMPLE COMMENT TEXT
                                </div>
                                <div class="actions">
                                    <a class="reply" data-commentid="1" data-commentnickname="Matt"
                                       th:attr="data-commentid=${comment.id},data-commentnickname=${comment.nickname}"
                                       onclick="reply(this)">REPLY</a>
                                </div>
                            </div>
                            <div class="comments" th:if="${#arrays.length(comment.replyComments)}>0">
                                <div class="comment" th:each="reply : ${comment.replyComments}">
                                    <a class="avatar">
                                        <img src="https://unsplash.it/100/100?image=1005" th:src="@{${reply.avatar}}">
                                    </a>
                                    <div class="content">
                                        <a class="author">
                                            <span th:text="${reply.nickname}">SAMPLE USER</span>
                                            <div class="ui mini basic purple left pointing label m-padded-mini"
                                                 th:if="${reply.adminComment}">ADMIN
                                            </div>
                                            &nbsp;<span th:text="|@ ${reply.parentComment.nickname}|" class="m-purple">@ SAMPLE USER</span>
                                        </a>
                                        <div class="metadata">
                                            <span class="date"
                                                  th:text="${#dates.format(reply.createTime,'yyyy-MM-dd HH:mm')}">SAMPLE TIME</span>
                                        </div>
                                        <div class="text" th:text="${reply.content}">
                                            SAMPLE COMMENT TEXT
                                        </div>
                                        <div class="actions">
                                            <a class="reply" data-commentid="1" data-commentnickname="Matt"
                                               th:attr="data-commentid=${reply.id},data-commentnickname=${reply.nickname}"
                                               onclick="reply(this)">Reply</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--comment forms-->
            <div id="comment-form" class="ui form">
                <input type="hidden" name="blog.id" th:value="${blog.id}">
                <input type="hidden" name="parentComment.id" value="-1">
                <!--comment text-->
                <div class="field">
                    <textarea name="content" placeholder="Leave a comment..." maxlength="500"></textarea>
                </div>

                <div class="fields">
                    <!--name form-->
                    <div class="field m-mobile-wide m-margin-bottom-small">
                        <div class="ui left icon input">
                            <i class="user icon"></i>
                            <input type="text" name="nickname" placeholder="Name"
                                   th:value="${session.user}!=null ? ${session.user.nickname}">
                        </div>
                    </div>
                    <!--email forms-->
                    <div class="field m-mobile-wide m-margin-bottom-small">
                        <div class="ui left icon input">
                            <i class="mail icon"></i>
                            <input type="text" name="email" placeholder="Email"
                                   th:value="${session.user}!=null ? ${session.user.email}">
                        </div>
                    </div>
                    <!--submit button-->
                    <div class="field  m-margin-bottom-small m-mobile-wide">
                        <button id="commentpost-btn" type="button" class="ui purple button m-mobile-wide"><i
                                class="edit icon"></i>Submit
                        </button>
                    </div>
                </div>

            </div>
            <!--comment forms-->
        </div>
        <!--Comment Section-->
    </div>
</div>
<!--Center Content-->

<!--Tool Bar-->
<div id="toolbar" class="m-padded m-fixed m-right-bottom" style="display: none">
    <div class="ui vertical icon buttons ">
        <button type="button" class="ui toc purple icon button"><i class="list icon"></i></button>
        <a href="#comment-container" class="ui purple icon button"><i class="comments outline icon"></i></a>
        <button class="ui qr icon button"><i class="qrcode icon"></i></button>
        <div id="toTop-button" class="ui icon button"><i class="chevron up icon"></i></div>
    </div>
</div>
<!--Tool Bar-->

<!--TOC-->
<div class="ui toc-container flowing popup transition hidden" style="width: 250px!important;">
    <ol class="js-toc">
    </ol>
</div>
<!--TOC-->

<!--QR Code-->
<div id="qrcode" class="ui instagram-qr flowing popup transition hidden " style="width: 130px !important;">
</div>
<!--QR Code-->

<br>
<br>
<!--Bottom footer-->
<footer th:replace="_fragments :: footer" class="ui inverted vertical segment m-padded-tb-massive">
    <!--replaced by fragment template-->

    <!--replaced by fragment template-->
</footer>
<!--Bottom footer-->

<!--javascript dependencies-->
<!--/*/<th:block th:replace="_fragments :: script">/*/-->
<!--CDN Release Of Jquery -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"></script>
<!--CDN Release Of Semantic UI -->
<script src="https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.js"></script>
<!--scroller plugin-->
<script src="//cdn.jsdelivr.net/npm/jquery.scrollto@2.1.2/jquery.scrollTo.min.js"></script>
<!--prism code viewer plugin-->
<script src="../static/lib/prism/prism.js"></script>
<!--table of content plugin -->
<script src="../static/lib/tocbot/tocbot.min.js"></script>
<!--qr code generation tool -->
<script src="../static/lib/qrcode/qrcode.min.js"></script>
<!--hide elements plugin-->
<script src="../static/lib/waypoints/jquery.waypoints.min.js"></script>
<!--/*/</th:block>/*/-->


<script th:inline="javascript">
    //toggle menu items
    $('.menu.toggle').click(function () {
        $('.m-item').toggleClass('m-mobile-hide');
    });

    //paypal qr pop up control
    $('#payButton').popup({
        popup: $('.payQR.popup'),
        on: 'click',
        position: 'bottom center'
    });

    //toc initiator
    tocbot.init({
        // Where to render the table of contents.
        tocSelector: '.js-toc',
        // Where to grab the headings to build the table of contents.
        contentSelector: '.js-toc-content',
        // Which headings to grab inside of the contentSelector element.
        headingSelector: 'h1, h2, h3',
    });

    $('.toc.button').popup({
        popup: $('.toc-container.popup'),
        on: 'click',
        position: 'left center'
    });

    //qrCode popup control
    $('.qr').popup({
        popup: $('.instagram-qr'),
        position: 'left center'
    });

    //generate new qr
    var serurl = /*[[#{blog.serurl}]]*/"127.0.0.1:8080";
    var url = /*[[@{/blog/{id}(id=${blog.id})}]]*/"";
    var qrcode = new QRCode("qrcode", {
        text: serurl + url,
        width: 110,
        height: 110,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
    });

    $('#toTop-button').click(function () {
        $(window).scrollTo(0, 500);
    });

    //hide toolbar when page is first loaded
    var waypoint = new Waypoint({
        element: document.getElementById('waypoint'),
        handler: function (direction) {
            if (direction == 'down') {
                $('#toolbar').show(100);
            } else {
                $('#toolbar').hide(500);
            }
            console.log('Scrolled to waypoint!  ' + direction);
        }
    })

    //form validation controller
    $('.ui.form').form({
        fields: {
            title: {
                identifier: 'content',
                rules: [{
                    type: 'empty',
                    prompt: 'Comment: can not be empty!'
                }
                ]
            },
            content: {
                identifier: 'nickname',
                rules: [{
                    type: 'empty',
                    prompt: 'Name: can not be empty!'
                }]
            },
            type: {
                identifier: 'email',
                rules: [{
                    type: 'email',
                    prompt: 'Email: please enter a valid email address!'
                }]
            }
        }
    });

    //load comments in to comment container
    $(function () {
        $("#comment-container").load(/*[[@{/comments/{id}(id=${blog.id})}]]*/"comments/6");
    });

    //comment button binding
    $('#commentpost-btn').click(function () {
        var boo = $('.ui.form').form('validate form');
        if (boo) {
            console.log('Validate success!');
            postData();
        } else {
            console.log('Validate failed!');
        }

    });

    //post comment when button is pressed
    function postData() {
        $("#comment-container").load(/*[[@{/comments}]]*/"", {
            "parentComment.id": $("[name='parentComment.id']").val(),
            "blog.id": $("[name='blog.id']").val(),
            "nickname": $("[name='nickname']").val(),
            "email": $("[name='email']").val(),
            "content": $("[name='content']").val()
        }, function (responseTxt, statusTxt, xhr) {
//        $(window).scrollTo($('#comment-container'),500);
            clearContent();
        });
    }

    //clear comment forms
    function clearContent() {
        $("[name='content']").val('');
        $("[name='parentComment.id']").val(-1);
        $("[name='content']").attr("placeholder", "Leave a comment...");
    }

    //reply
    function reply(obj) {
        var commentId = $(obj).data('commentid');
        var commentNickname = $(obj).data('commentnickname');
        $("[name='content']").attr("placeholder", "@" + commentNickname).focus();
        $("[name='parentComment.id']").val(commentId);
        $(window).scrollTo($('#comment-form'), 500);
    }


</script>
</body>
</html>